FROM alpine:latest

WORKDIR /vps

COPY ssl /vps/ssl
COPY lib /vps/lib
COPY modules /vps/modules
COPY router.py /vps/router.py
COPY uwsgi.ini /vps/uwsgi.ini
COPY templates /vps/templates
COPY passthru/nginx.conf /etc/nginx/nginx.conf
EXPOSE 443

RUN apk update
RUN apk add python3-dev py3-pip py3-virtualenv

RUN apk add openssl openssl-dev 

RUN apk add nginx

RUN apk add gcc build-base musl-dev linux-headers  pcre-dev

RUN apk add uwsgi-python3

RUN python3 -m venv /vps/venv
RUN venv/bin/pip3 install --upgrade pip setuptools wheel
RUN venv/bin/pip3 install flask flask-bootstrap mysql-connector-python jinja2 uwsgi

CMD [ "uwsgi", "--ini", "/vps/uwsgi.ini", "--chdir", "/vps", "--plugin", "python3", "--callable", "app", "--virtualenv", "/vps/venv" ]
